<p>&nbsp;</p>
<dt>
<div>
<div>binascii.crc32(s [,crc])</div>
<div>返回CRC32校验。参数'crc'指定初始值用于循环。例如：</div>
</div>
</dt>
<p>&nbsp;</p>
<div class="cnblogs_code"><img id="Code_Closed_Image_172113" style="display: none;" onclick="this.style.display='none'; document.getElementById('Code_Closed_Text_172113').style.display='none'; document.getElementById('Code_Open_Image_172113').style.display='inline'; document.getElementById('Code_Open_Text_172113').style.display='inline';" height="16" src="http://www.cnblogs.com/images/OutliningIndicators/ContractedBlock.gif" width="11" align="top" /><img id="Code_Open_Image_172113" onclick="this.style.display='none'; document.getElementById('Code_Open_Text_172113').style.display='none'; getElementById('Code_Closed_Image_172113').style.display='inline'; getElementById('Code_Closed_Text_172113').style.display='inline';" height="16" src="http://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockStart.gif" width="11" align="top" /><span id="Code_Closed_Text_172113" class="cnblogs_code_Collapse">Code</span><span id="Code_Open_Text_172113"><br /><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #000000;">&gt;&gt;&gt;</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">import</span><span style="color: #000000;">&nbsp;binascii<br /></span><span style="color: #000000;">&gt;&gt;&gt;</span><span style="color: #000000;">&nbsp;crc&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;binascii.crc32(</span><span style="color: #800000;">'</span><span style="color: #800000;">spam</span><span style="color: #800000;">'</span><span style="color: #000000;">)<br /></span><span style="color: #000000;">&gt;&gt;&gt;</span><span style="color: #000000;">&nbsp;binascii.crc32(</span><span style="color: #800000;">'</span><span style="color: #800000;">&nbsp;and&nbsp;eggs</span><span style="color: #800000;">'</span><span style="color: #000000;">,&nbsp;crc)<br /></span><span style="color: #000000;">739139840</span><span style="color: #000000;"><br /></span><span style="color: #000000;">&gt;&gt;&gt;</span><span style="color: #000000;">&nbsp;binascii.crc32(</span><span style="color: #800000;">'</span><span style="color: #800000;">spam&nbsp;and&nbsp;eggs</span><span style="color: #800000;">'</span><span style="color: #000000;">)<br /></span><span style="color: #000000;">739139840</span></span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="cnblogs_code"><img align="top" width="11" src="http://www.cnblogs.com/images/OutliningIndicators/ContractedBlock.gif" height="16" onclick="this.style.display='none'; document.getElementById('Code_Closed_Text_172240').style.display='none'; document.getElementById('Code_Open_Image_172240').style.display='inline'; document.getElementById('Code_Open_Text_172240').style.display='inline';" style="display: none;" id="Code_Closed_Image_172240" /><img align="top" width="11" src="http://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockStart.gif" height="16" onclick="this.style.display='none'; document.getElementById('Code_Open_Text_172240').style.display='none'; getElementById('Code_Closed_Image_172240').style.display='inline'; getElementById('Code_Closed_Text_172240').style.display='inline';" id="Code_Open_Image_172240" /><span class="cnblogs_code_Collapse" id="Code_Closed_Text_172240">Code</span><span id="Code_Open_Text_172240"><br /><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #0000ff;">import</span><span style="color: #000000;">&nbsp;binascii&nbsp;<br /><br /></span><span style="color: #0000ff;">def</span><span style="color: #000000;">&nbsp;getFileCRC(_path):&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">try</span><span style="color: #000000;">:&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blocksize&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">1024</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">64</span><span style="color: #000000;">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;open(_path,</span><span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;f.read(blocksize)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crc&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;0&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">while</span><span style="color: #000000;">(len(str)&nbsp;</span><span style="color: #000000;">!=</span><span style="color: #000000;">&nbsp;0):&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crc&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;binascii.crc32(str,&nbsp;crc)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;f.read(blocksize)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.close()&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">except</span><span style="color: #000000;">:&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">print</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">'</span><span style="color: #800000;">get&nbsp;file&nbsp;crc&nbsp;error!</span><span style="color: #800000;">'</span><span style="color: #000000;">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;0&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;crc&nbsp;&nbsp;</span></span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="cnblogs_code"><img id="Code_Closed_Image_173006" style="display: none;" onclick="this.style.display='none'; document.getElementById('Code_Closed_Text_173006').style.display='none'; document.getElementById('Code_Open_Image_173006').style.display='inline'; document.getElementById('Code_Open_Text_173006').style.display='inline';" height="16" src="http://www.cnblogs.com/images/OutliningIndicators/ContractedBlock.gif" width="11" align="top" /><img id="Code_Open_Image_173006" onclick="this.style.display='none'; document.getElementById('Code_Open_Text_173006').style.display='none'; getElementById('Code_Closed_Image_173006').style.display='inline'; getElementById('Code_Closed_Text_173006').style.display='inline';" height="16" src="http://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockStart.gif" width="11" align="top" /><span id="Code_Closed_Text_173006" class="cnblogs_code_Collapse">Code</span><span id="Code_Open_Text_173006"><br /><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #000000;">python&nbsp;</span><span style="color: #000000;">2</span><span style="color: #000000;">.X的crc32實作上跟一般的C實作上在整數有號無號的處理上略有不同,&nbsp;所以使用python&nbsp;</span><span style="color: #000000;">2</span><span style="color: #000000;">.X與一般C實作算出的crc32(如sfv)比對時,通常需要特別的方法,<br /><br />這邊列出一個透過zlib.crc32快速得到所需要結果的方法：<br /><br /><br /></span><span style="color: #0000ff;">import</span><span style="color: #000000;">&nbsp;zlib<br /><br /></span><span style="color: #0000ff;">def</span><span style="color: #000000;">&nbsp;crc32(st):<br />&nbsp;&nbsp;&nbsp;&nbsp;crc&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;zlib.crc32(st)<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;">&nbsp;crc&nbsp;</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">&nbsp;0:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">%x</span><span style="color: #800000;">"</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">%</span><span style="color: #000000;">&nbsp;(crc)<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">else</span><span style="color: #000000;">:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">%x</span><span style="color: #800000;">"</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">%</span><span style="color: #000000;">&nbsp;(</span><span style="color: #000000;">~</span><span style="color: #000000;">crc&nbsp;</span><span style="color: #000000;">^</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">0xffffffff</span><span style="color: #000000;">)<br /><br />ex1&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">12345</span><span style="color: #800000;">"</span><span style="color: #000000;"><br />ex2&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">1kcaseztsa12345azy</span><span style="color: #800000;">"</span><span style="color: #000000;"><br /><br /></span><span style="color: #0000ff;">print</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">%x</span><span style="color: #800000;">"</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">%</span><span style="color: #000000;">&nbsp;zlib.crc32(ex1)<br /></span><span style="color: #0000ff;">print</span><span style="color: #000000;">&nbsp;crc32(ex1)<br /></span><span style="color: #0000ff;">print</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">%x</span><span style="color: #800000;">"</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">%</span><span style="color: #000000;">&nbsp;zlib.crc32(ex2)<br /></span><span style="color: #0000ff;">print</span><span style="color: #000000;">&nbsp;crc32(ex2)<br /><br /><br />或如果你有ctypes的話:<br /></span><span style="color: #0000ff;">import</span><span style="color: #000000;">&nbsp;zlib<br /></span><span style="color: #0000ff;">import</span><span style="color: #000000;">&nbsp;ctypes<br /><br /></span><span style="color: #0000ff;">def</span><span style="color: #000000;">&nbsp;crc32_c(st):<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">%x</span><span style="color: #800000;">"</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">%</span><span style="color: #000000;">&nbsp;ctypes.c_uint32(zlib.crc32(st)).value<br /><br />ex1&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">12345</span><span style="color: #800000;">"</span><span style="color: #000000;"><br />ex2&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">1kcaseztsa12345azy</span><span style="color: #800000;">"</span><span style="color: #000000;"><br /><br /></span><span style="color: #0000ff;">print</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">%x</span><span style="color: #800000;">"</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">%</span><span style="color: #000000;">&nbsp;zlib.crc32(ex1)<br /></span><span style="color: #0000ff;">print</span><span style="color: #000000;">&nbsp;crc32_c(ex1)<br /></span><span style="color: #0000ff;">print</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">%x</span><span style="color: #800000;">"</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">%</span><span style="color: #000000;">&nbsp;zlib.crc32(ex2)<br /></span><span style="color: #0000ff;">print</span><span style="color: #000000;">&nbsp;crc32_c(ex2)<br /><br /><br /><br />註：&nbsp;python&nbsp;</span><span style="color: #000000;">3</span><span style="color: #000000;">.0以上沒有這個問題.</span></span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="cnblogs_code"><img align="top" width="11" src="http://www.cnblogs.com/images/OutliningIndicators/ContractedBlock.gif" height="16" onclick="this.style.display='none'; document.getElementById('Code_Closed_Text_173528').style.display='none'; document.getElementById('Code_Open_Image_173528').style.display='inline'; document.getElementById('Code_Open_Text_173528').style.display='inline';" style="display: none;" id="Code_Closed_Image_173528" /><img align="top" width="11" src="http://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockStart.gif" height="16" onclick="this.style.display='none'; document.getElementById('Code_Open_Text_173528').style.display='none'; getElementById('Code_Closed_Image_173528').style.display='inline'; getElementById('Code_Closed_Text_173528').style.display='inline';" id="Code_Open_Image_173528" /><span class="cnblogs_code_Collapse" id="Code_Closed_Text_173528">Code</span><span id="Code_Open_Text_173528"><br /><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #0000ff;">from</span><span style="color: #000000;">&nbsp;ctypes&nbsp;</span><span style="color: #0000ff;">import</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;<br /></span><span style="color: #0000ff;">import</span><span style="color: #000000;">&nbsp;binascii&nbsp;<br /><br /></span><span style="color: #0000ff;">def</span><span style="color: #000000;">&nbsp;getFileCRC(_path):&nbsp;<br /></span><span style="color: #0000ff;">try</span><span style="color: #000000;">:&nbsp;<br />blocksize&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">1024</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">64</span><span style="color: #000000;">&nbsp;<br />f&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;open(_path,</span><span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)&nbsp;<br />str&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;f.read(blocksize)&nbsp;<br />crc&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;0&nbsp;<br /></span><span style="color: #0000ff;">while</span><span style="color: #000000;">(len(str)&nbsp;</span><span style="color: #000000;">!=</span><span style="color: #000000;">&nbsp;0):&nbsp;<br />crc&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;binascii.crc32(str,&nbsp;crc)&nbsp;<br />str&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;f.read(blocksize)&nbsp;<br />f.close()&nbsp;<br /></span><span style="color: #0000ff;">except</span><span style="color: #000000;">:&nbsp;<br />klog.error(</span><span style="color: #800000;">"</span><span style="color: #800000;">get&nbsp;file&nbsp;crc&nbsp;error!</span><span style="color: #800000;">"</span><span style="color: #000000;">)&nbsp;<br /></span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;0&nbsp;<br /></span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;c_uint(crc).value</span></span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>]]